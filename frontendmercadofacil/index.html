<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TecnoShop - Ofertas Exclusivas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* Cor de fundo suave */
        }
        .text-shadow-custom {
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        /* Garantir que a imagem em object-contain tenha uma altura definida e ocupe o espa√ßo */
        .produto-card img {
            max-width: 100%;
            height: 12rem; /* h-48 no Tailwind */
        }
    </style>
</head>
<body class="min-h-screen antialiased">

    <header class="bg-gray-900 text-white py-20 md:py-32">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <h1 class="text-4xl sm:text-6xl font-extrabold mb-4 leading-tight text-shadow-custom">
                üöÄ Power Up Seu Setup!
            </h1>
            <p class="text-xl sm:text-2xl font-light mb-8 opacity-90">
                A melhor tecnologia com pre√ßos que voc√™ nunca viu.
            </p>
            <a href="#produtos" class="inline-block px-8 py-3 bg-indigo-600 hover:bg-indigo-700 text-white text-lg font-semibold rounded-lg shadow-lg transition duration-300 ease-in-out transform hover:scale-105">
                Ver Todas as Ofertas
            </a>
        </div>
    </header>

    <main class="py-12 md:py-20">
        <section id="produtos" class="max-w-7xl mx-auto px-4">
            <h2 class="text-3xl sm:text-4xl font-bold text-gray-800 mb-10 text-center">
                üî• Produtos em Destaque
            </h2>
            <div id="lista-produtos" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
                <p class="col-span-full text-center text-gray-500">Carregando produtos...</p>
            </div>
            
            <div id="status-message" class="mt-8 text-center text-red-600 font-medium hidden"></div>

        </section>

        <section class="bg-indigo-50 mt-20 py-16">
            <div class="max-w-7xl mx-auto px-4 text-center">
                <h3 class="text-2xl md:text-3xl font-bold text-gray-800 mb-4">
                    Compre com Confian√ßa!
                </h3>
                <p class="text-gray-600 mb-8 max-w-2xl mx-auto">
                    Todos os produtos s√£o novos, com garantia total e enviados com seguro. N√£o perca essa chance de evoluir seu setup.
                </p>
                <a href="#" class="inline-block px-8 py-3 bg-gray-900 hover:bg-gray-700 text-white text-lg font-semibold rounded-lg transition duration-300 ease-in-out">
                    Fale com Nossos Especialistas
                </a>
            </div>
        </section>
    </main>

    <footer class="bg-gray-900 text-white py-6">
        <div class="max-w-7xl mx-auto px-4 text-center text-sm opacity-80">
            &copy; 2025 TecnoShop. Todos os direitos reservados. | Privacidade e Termos
        </div>
    </footer>

    <script>
        // URL da API que deve estar rodando na porta 3000
        const API_URL = 'http://localhost:3000/api/produtos'; 

        /**
         * Formata o pre√ßo como moeda brasileira (R$).
         * @param {number} preco - O pre√ßo do produto.
         * @returns {string} - O pre√ßo formatado.
         */
        const formatarPreco = (preco) => {
            // Garante que o pre√ßo √© um n√∫mero antes de formatar
            const numPreco = parseFloat(preco); 
            if (isNaN(numPreco)) return 'Pre√ßo indispon√≠vel';
            
            return numPreco.toLocaleString('pt-BR', { 
                style: 'currency', 
                currency: 'BRL' 
            });
        };

        /**
         * Cria e retorna o elemento HTML para um √∫nico card de produto.
         * @param {Object} produto - Objeto com { id, nome, preco, url_imagem }.
         * @returns {HTMLElement} - O card do produto.
         */
        const criarCardProduto = (produto) => {
            const card = document.createElement('div');
            card.className = "produto-card bg-white p-6 rounded-xl shadow-xl hover:shadow-2xl transition duration-300 transform hover:-translate-y-1 flex flex-col justify-between";
            
            // L√≥gica para usar url_imagem se dispon√≠vel, sen√£o usa placeholder
            const placeholderText = encodeURIComponent(produto.nome).substring(0, 15);
            // Placeholder de fallback para erro de carregamento
            const fallbackPlaceholderUrl = `https://placehold.co/150x150/cccccc/000000?text=Sem+Foto`;

            // Placeholder original caso a URL_IMAGEM esteja vazia no BD
            const placeholderUrl = `https://placehold.co/400x300/e0e7ff/3730a3?text=${placeholderText}`;
            
            // A imagem real ser√° a url_imagem que vem do banco de dados, se ela n√£o for nula/vazia.
            const finalImageUrl = produto.url_imagem && produto.url_imagem.trim() !== '' ? produto.url_imagem : placeholderUrl;


            card.innerHTML = `
                <div class="text-center">
                    <img 
                        src="${finalImageUrl}" 
                        alt="${produto.nome}" 
                        class="w-full h-48 object-contain rounded-lg mb-4 mx-auto border border-indigo-100"
                        
                        onerror="this.onerror=null; this.src='${fallbackPlaceholderUrl}'"
                    />

                    <h3 class="text-xl font-semibold text-gray-900 mb-2 h-14 overflow-hidden leading-snug">
                        ${produto.nome}
                    </h3>
                </div>

                <div>
                    <p class="text-3xl font-extrabold text-indigo-600 my-3">
                        ${formatarPreco(produto.preco)}
                    </p>
                    <button 
                        data-id="${produto.id}" 
                        class="btn-comprar w-full bg-pink-500 hover:bg-pink-600 text-white font-bold py-3 px-4 rounded-lg transition duration-300 shadow-md hover:shadow-lg"
                    >
                        Comprar Agora üõí
                    </button>
                </div>
            `;
            
            // Adiciona o listener de evento para o bot√£o Comprar
            card.querySelector('.btn-comprar').addEventListener('click', (event) => {
                const produtoId = event.target.getAttribute('data-id');
                // Substitua 'alert' por um modal ou redirecionamento real para o carrinho
                console.log(`Produto ID ${produtoId} (${produto.nome}) adicionado ao carrinho!`);
                window.location.href = './pagamento.html?id=' + produto.id;

            });

            return card;
        };

        /**
         * Renderiza a lista de produtos na interface.
         * @param {Array<Object>} listaProdutos - Array de objetos de produto.
         */
        const renderizarProdutos = (listaProdutos) => {
            const container = document.getElementById('lista-produtos');
            container.innerHTML = ''; // Limpa o conte√∫do de "Carregando"

            if (!listaProdutos || listaProdutos.length === 0) {
                container.innerHTML = `
                    <p class="col-span-full text-center text-xl text-gray-500 py-10">
                        Nenhum produto em estoque no momento.
                    </p>
                `;
                return;
            }

            listaProdutos.forEach(produto => {
                container.appendChild(criarCardProduto(produto));
            });
        };

        /**
         * Fun√ß√£o principal de inicializa√ß√£o que busca os dados da API.
         */const usuario = JSON.parse(localStorage.getItem("usuario"));

if (!usuario) {
  window.location.href = "http://127.0.0.1:5500/Mercado_Facil_Login/index.html";
}

        document.addEventListener('DOMContentLoaded', async () => {
            const statusMessage = document.getElementById('status-message');
            const listaProdutosContainer = document.getElementById('lista-produtos');

            try {
                // Tenta buscar os dados do seu backend
                const response = await fetch(API_URL);
                
                if (!response.ok) {
                    // Lan√ßa um erro se o status HTTP n√£o for 200 (OK)
                    throw new Error(`Erro ao buscar dados: Status ${response.status}`);
                }
                
                const data = await response.json(); 
                
                renderizaProdutos(data);
                
            } catch (error) {
                // Captura erros de rede, CORS, ou erros de status HTTP
                console.error('ERRO DE INTEGRA√á√ÉO COM A API:', error);
                
                // Exibe mensagem de erro na UI
                listaProdutosContainer.innerHTML = ''; // Limpa o "Carregando"
                statusMessage.classList.remove('hidden');
                statusMessage.textContent = `‚ùå Erro ao carregar produtos. Verifique se o servidor (${API_URL}) est√° ativo e o CORS est√° habilitado. Detalhes: ${error.message}`;
            }
        });
    </script>
</body>
</html>